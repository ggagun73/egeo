<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="Log">

	<typeAlias alias="logVO" type="usolver.com.sysLog.vo.LogVO"/>
	<sql id="logCommonWhere">
	  	<isNotEmpty prepend="AND" property="sys_div">
	  		SYS_ID = #sys_div#
	  	</isNotEmpty> 
	  	<isNotEmpty prepend="AND" property="select_dept">
	  		<isEqual property="select_dept" compareValue="bucheon" >
	  			USER_DEPT_M_UPPER NOT IN ('오정구', '원미구', '소사구')
	  		</isEqual>
	  		<isEqual property="select_dept" compareValue="ojung" >
	  			USER_DEPT_M_UPPER = '오정구'
	  		</isEqual>
	  		<isEqual property="select_dept" compareValue="wonmi" >
	  			USER_DEPT_M_UPPER = '원미구'
	  		</isEqual>
	  		<isEqual property="select_dept" compareValue="sosa" >
	  			USER_DEPT_M_UPPER = '소사구'
	  		</isEqual>
	  	</isNotEmpty> 
	  	<isNotEmpty prepend="AND" property="ANS_TERM_S">
		  	<![CDATA[
		  		TO_CHAR(CON_TIME, 'YYYY-MM-DD') >= #ANS_TERM_S#
		    ]]>
    	</isNotEmpty>
	  	<isNotEmpty prepend="AND" property="ANS_TERM_E">
		  	<![CDATA[
		        TO_CHAR(CON_TIME, 'YYYY-MM-DD') <= #ANS_TERM_E#
		    ]]>
    	</isNotEmpty>
	</sql>
	
	<select id="content.sysLog.Log" parameterClass="logVO" resultClass="logVO">
		SELECT * FROM USV_LOG_USER
		WHERE
			SYS_ID = #SYS_ID#
	</select>
	
	<select id="content.sysLog.getMonthly" parameterClass="logVO" resultClass="logVO">
		WITH COUNT_DATA AS (
		  SELECT COUNT(*) AS CNT, USER_ID, SUBSTR(LOG_DATE,5,2) AS MM 
		  	FROM USV_LOG_USER
		  	WHERE 1=1
			<include refid="logCommonWhere" />
		  	GROUP BY USER_ID, SUBSTR(LOG_DATE,5,2)
		)
		SELECT 
		  A.USER_ID
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='01'), 0) AS MON01
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='02'), 0) AS MON02
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='03'), 0) AS MON03
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='04'), 0) AS MON04
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='05'), 0) AS MON05
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='06'), 0) AS MON06
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='07'), 0) AS MON07
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='08'), 0) AS MON08
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='09'), 0) AS MON09
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='10'), 0) AS MON10
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='11'), 0) AS MON11
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='12'), 0) AS MON12
		  ,NVL((SELECT COUNT(LOG_DATE) FROM USV_LOG_USER WHERE USER_ID=A.USER_ID
			<include refid="logCommonWhere" />
		    ), 0) AS SUM_MON
		  FROM 
		(SELECT DISTINCT USER_ID FROM USV_LOG_USER) A
		ORDER BY USER_ID ASC
	</select>
	
	<select id="content.sysLog.getMonthlyExcel" parameterClass="logVO" resultClass="hashmap">
		WITH COUNT_DATA AS (
		  SELECT COUNT(*) AS CNT, USER_ID, SUBSTR(LOG_DATE,5,2) AS MM 
		  	FROM USV_LOG_USER
		  	WHERE 1=1
			<include refid="logCommonWhere" />
		  	GROUP BY USER_ID, SUBSTR(LOG_DATE,5,2)
		)
		SELECT 
		  A.USER_ID
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='01'), 0) AS MON01
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='02'), 0) AS MON02
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='03'), 0) AS MON03
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='04'), 0) AS MON04
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='05'), 0) AS MON05
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='06'), 0) AS MON06
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='07'), 0) AS MON07
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='08'), 0) AS MON08
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='09'), 0) AS MON09
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='10'), 0) AS MON10
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='11'), 0) AS MON11
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND MM='12'), 0) AS MON12
		  ,NVL((SELECT COUNT(LOG_DATE) FROM USV_LOG_USER WHERE USER_ID=A.USER_ID
			<include refid="logCommonWhere" />
		    ), 0) AS SUM_MON
		  FROM 
		(SELECT DISTINCT USER_ID FROM USV_LOG_USER) A
		ORDER BY USER_ID ASC
	</select>
	
	<select id="content.sysLog.getWeekly" parameterClass="logVO" resultClass="logVO">
		WITH COUNT_DATA AS (
		  SELECT COUNT(*) AS CNT, USER_ID, TO_CHAR(CON_TIME, 'D') AS DY
		  	FROM USV_LOG_USER
		  	WHERE 1=1
			<include refid="logCommonWhere" />
		  	GROUP BY USER_ID, TO_CHAR(CON_TIME, 'D')
		)
		
		SELECT 
		  A.USER_ID
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='1'), 0) AS WEEK01
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='2'), 0) AS WEEK02
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='3'), 0) AS WEEK03
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='4'), 0) AS WEEK04
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='5'), 0) AS WEEK05
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='6'), 0) AS WEEK06
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='7'), 0) AS WEEK07
		    ,NVL((SELECT COUNT(LOG_DATE) FROM USV_LOG_USER WHERE USER_ID=A.USER_ID
			<include refid="logCommonWhere" />
		    ), 0) AS SUM_WEEK
			
		  FROM 
		(SELECT DISTINCT USER_ID FROM USV_LOG_USER) A
		
		ORDER BY USER_ID ASC
	</select>	
	
	<select id="content.sysLog.getWeeklyExcel" parameterClass="logVO" resultClass="hashmap">
		WITH COUNT_DATA AS (
		  SELECT COUNT(*) AS CNT, USER_ID, TO_CHAR(CON_TIME, 'D') AS DY
		  	FROM USV_LOG_USER
		  	WHERE 1=1
			<include refid="logCommonWhere" />
		  	GROUP BY USER_ID, TO_CHAR(CON_TIME, 'D')
		)
		
		SELECT 
		  A.USER_ID
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='1'), 0) AS WEEK01
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='2'), 0) AS WEEK02
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='3'), 0) AS WEEK03
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='4'), 0) AS WEEK04
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='5'), 0) AS WEEK05
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='6'), 0) AS WEEK06
		    ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DY='7'), 0) AS WEEK07
		    ,NVL((SELECT COUNT(LOG_DATE) FROM USV_LOG_USER WHERE USER_ID=A.USER_ID
			<include refid="logCommonWhere" />
		    ), 0) AS SUM_WEEK
			
		  FROM 
		(SELECT DISTINCT USER_ID FROM USV_LOG_USER) A
		
		ORDER BY USER_ID ASC
	</select>	
	
	<select id="content.sysLog.getDaily" parameterClass="logVO" resultClass="logVO">
		WITH COUNT_DATA AS (
		  SELECT COUNT(*) AS CNT, USER_ID, SUBSTR(LOG_DATE,7,2) AS DD 
		  	FROM USV_LOG_USER
		  	WHERE 1=1
			<include refid="logCommonWhere" />
		  	GROUP BY USER_ID, SUBSTR(LOG_DATE,7,2)
		)
		SELECT 
		  A.USER_ID
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='01'), 0) AS DAY01
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='02'), 0) AS DAY02
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='03'), 0) AS DAY03
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='04'), 0) AS DAY04
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='05'), 0) AS DAY05
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='06'), 0) AS DAY06
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='07'), 0) AS DAY07
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='08'), 0) AS DAY08
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='09'), 0) AS DAY09
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='10'), 0) AS DAY10
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='11'), 0) AS DAY11
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='12'), 0) AS DAY12
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='13'), 0) AS DAY13
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='14'), 0) AS DAY14
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='15'), 0) AS DAY15
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='16'), 0) AS DAY16
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='17'), 0) AS DAY17
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='18'), 0) AS DAY18
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='19'), 0) AS DAY19
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='20'), 0) AS DAY20
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='21'), 0) AS DAY21
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='22'), 0) AS DAY22
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='23'), 0) AS DAY23
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='24'), 0) AS DAY24
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='25'), 0) AS DAY25
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='26'), 0) AS DAY26
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='27'), 0) AS DAY27
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='28'), 0) AS DAY28
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='29'), 0) AS DAY29
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='30'), 0) AS DAY30
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='31'), 0) AS DAY31
		  ,NVL((SELECT COUNT(LOG_DATE) FROM USV_LOG_USER WHERE USER_ID=A.USER_ID
			<include refid="logCommonWhere" />
		    ), 0) AS SUM_DAY
		  FROM 
		(SELECT DISTINCT USER_ID FROM USV_LOG_USER) A
		ORDER BY USER_ID ASC
	</select>
	
	<select id="content.sysLog.getDailyExcel" parameterClass="logVO" resultClass="hashmap">
		WITH COUNT_DATA AS (
		  SELECT COUNT(*) AS CNT, USER_ID, SUBSTR(LOG_DATE,7,2) AS DD 
		  	FROM USV_LOG_USER
		  	WHERE 1=1
			<include refid="logCommonWhere" />
		  	GROUP BY USER_ID, SUBSTR(LOG_DATE,7,2)
		)
		SELECT 
		  A.USER_ID
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='01'), 0) AS DAY01
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='02'), 0) AS DAY02
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='03'), 0) AS DAY03
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='04'), 0) AS DAY04
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='05'), 0) AS DAY05
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='06'), 0) AS DAY06
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='07'), 0) AS DAY07
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='08'), 0) AS DAY08
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='09'), 0) AS DAY09
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='10'), 0) AS DAY10
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='11'), 0) AS DAY11
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='12'), 0) AS DAY12
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='13'), 0) AS DAY13
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='14'), 0) AS DAY14
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='15'), 0) AS DAY15
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='16'), 0) AS DAY16
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='17'), 0) AS DAY17
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='18'), 0) AS DAY18
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='19'), 0) AS DAY19
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='20'), 0) AS DAY20
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='21'), 0) AS DAY21
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='22'), 0) AS DAY22
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='23'), 0) AS DAY23
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='24'), 0) AS DAY24
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='25'), 0) AS DAY25
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='26'), 0) AS DAY26
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='27'), 0) AS DAY27
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='28'), 0) AS DAY28
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='29'), 0) AS DAY29
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='30'), 0) AS DAY30
		  ,NVL((SELECT CNT FROM COUNT_DATA WHERE USER_ID=A.USER_ID AND DD='31'), 0) AS DAY31
		  ,NVL((SELECT COUNT(LOG_DATE) FROM USV_LOG_USER WHERE USER_ID=A.USER_ID
			<include refid="logCommonWhere" />
		    ), 0) AS SUM_DAY
		  FROM 
		(SELECT DISTINCT USER_ID FROM USV_LOG_USER) A
		ORDER BY USER_ID ASC
	</select>
	
</sqlMap>
